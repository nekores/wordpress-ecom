"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0c39360b-8690-5b66-9f3f-3e20095fc315")}catch(e){}}();
(globalThis.webpackChunkwoocommerce_shipping=globalThis.webpackChunkwoocommerce_shipping||[]).push([[541],{3922:(e,r,a)=>{a.r(r),a.d(r,{default:()=>M});var t={};a.r(t),a.d(t,{getLabelsReport:()=>x,getState:()=>S});var o={};a.r(o),a.d(o,{fetchLabelsSuccess:()=>k});var i={};a.r(i),a.d(i,{getLabelsReport:()=>C});var s=a(2508),n=a(7143),c=a(6161),p=a(6087);const l=e=>(0,p.mapKeys)(e,((e,r)=>(0,p.camelCase)(r)));a(5703);var d=a(8443),m=a(7723);(0,p.memoize)((e=>(0,p.groupBy)(e,"serviceId")));const u=e=>{try{return new ActiveXObject(e)}catch{}};(0,p.memoize)((()=>(0,p.get)(window,"navigator.msSaveOrOpenBlob")?"ie":/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(navigator.userAgent)&&!window.MSStream?"addon":(0,p.includes)(navigator.userAgent,"Firefox")?parseFloat(navigator.userAgent.split("Firefox/")[1])>=94?"native_ff":"addon":(0,p.includes)(navigator.userAgent,"Safari")&&!(0,p.includes)(navigator.userAgent,"Chrome")?"addon":navigator.mimeTypes?.["application/pdf"]||navigator.pdfViewerEnabled?"native":!(!u("AcroPDF.PDF")&&!u("PDF.PdfCtrl"))&&"addon"));var g=a(3832);a(8490);var h=a(7374);const w=["created_date","order_id","rate","service_name","refund","tracking","carrier_id"],f=e=>{return(0,g.addQueryArgs)("/wcshipping/v1/reports/labels",(r=(e=>{const{period:r,compare:a,before:t,after:o}=(0,h.getDateParamsFromQuery)(e),{primary:i,secondary:s}=(0,h.getCurrentDates)(e);return{period:r,compare:a,before:t,after:o,primary:i,secondary:s}})(e),a={perPage:e.perPage,offset:e.offset},{after:encodeURIComponent((0,h.appendTimestamp)(r.primary.after,"start")),before:encodeURIComponent((0,h.appendTimestamp)(r.primary.before,"end")),per_page:a.perPage,offset:a.offset,fields:w}));var r,a};var y=a(1455),v=a.n(y);const b="ANALYTICS/FETCH_LABELS_SUCCESS",_=(e=>{const r={},a=()=>(a=e,t)=>{const o=r[t.type];return"function"==typeof o?o(a,t):a},t=(e,o)=>(r[e]=o,{on:t,bind:a});return{on:t,bind:a}})({data:void 0}).on(b,((e,{payload:{query:r,result:a}})=>{var t;return{...e,data:{...null!==(t=e.data)&&void 0!==t?t:{},[JSON.stringify(r)]:{rows:a.rows,meta:a.meta}}}})).bind(),S=e=>e,x=(e,r)=>e.data?.[JSON.stringify(r)],k=e=>({type:b,payload:e});function*C(e){const{rows:r,meta:a}=yield(0,c.apiFetch)({path:f(e),method:"GET"});return k({query:e,result:{rows:r.map(l),meta:l(a)}})}let A;var P=a(8846),F=a(5359),j=a(6932),L=a(6295),D=a(8468),I=a(1554),T=a(6070);const N=()=>(0,T.jsx)("svg",{role:"img","aria-hidden":"true",focusable:"false",version:"1.1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 24 24",style:{width:"24px",height:"24px",marginRight:"8px"},children:(0,T.jsx)("path",{d:"M18,9c-0.009,0-0.017,0.002-0.025,0.003C17.72,5.646,14.922,3,11.5,3C7.91,3,5,5.91,5,9.5c0,0.524,0.069,1.031,0.186,1.519 C5.123,11.016,5.064,11,5,11c-2.209,0-4,1.791-4,4c0,1.202,0.541,2.267,1.38,3h18.593C22.196,17.089,23,15.643,23,14 C23,11.239,20.761,9,18,9z M12,16l-4-5h3V8h2v3h3L12,16z"})}),R={usps:e=>`https://tools.usps.com/go/TrackConfirmAction.action?tLabels=${e}`,fedex:e=>`https://www.fedex.com/apps/fedextrack/?action=track&tracknumbers=${e}`,ups:e=>`https://www.ups.com/track?loc=en_US&tracknum=${e}`,upsdap:e=>`https://www.ups.com/track?loc=en_US&tracknum=${e}`,dhlexpress:e=>`https://www.dhl.com/en/express/tracking.html?AWB=${e}&brand=DHL`},q=e=>r=>{var a,t;const o=r.createdDate?(0,d.dateI18n)("M d, Y g:i a",new Date(r.createdDate),!1):null;return[{display:o,value:o},{display:(0,T.jsx)(P.Link,{href:`post.php?post=${r.orderId}&action=edit`,type:"wp-admin",target:"_blank",children:`#${r.orderId}`}),value:r.orderId},{display:e?.render(null!==(a=r.rate)&&void 0!==a?a:0),value:null!==(t=r.rate)&&void 0!==t?t:0},{display:r.serviceName,value:r.serviceName},{display:r.carrierId&&r.tracking&&R[r.carrierId]?(0,T.jsx)(P.Link,{href:R[r.carrierId](r.tracking),target:"_blank",type:"external",children:r.tracking}):r.tracking,value:r.tracking},{display:r.refund?.status,value:r.refund?.status}]},B=[{key:"createdDate",label:(0,m.__)("Date","woocommerce-shipping"),isLeftAligned:!0,isSortable:!1,required:!0},{key:"orderId",label:(0,m.__)("Order","woocommerce-shipping"),isSortable:!1,isNumeric:!1,required:!0},{key:"rate",label:(0,m.__)("Price","woocommerce-shipping"),isSortable:!1,isNumeric:!0,required:!0},{key:"serviceName",label:(0,m.__)("Service","woocommerce-shipping"),isSortable:!1,isNumeric:!1,required:!0},{key:"tracking",label:(0,m.__)("Tracking Number","woocommerce-shipping"),isSortable:!1,isLeftAligned:!0,isNumeric:!0,required:!1},{key:"refund",label:(0,m.__)("Refund status","woocommerce-shipping"),isSortable:!1,isNumeric:!1}],E=({query:e,path:r,currency:a})=>{var t;const[o,i]=(0,D.useState)({perPage:25,paged:1}),[s,c]=(0,D.useState)(!1),[d,u]=(0,D.useState)([]),g={rows:[],summary:[]},w=(0,n.useSelect)((r=>(u([]),r(A).getLabelsReport({...e,perPage:o.perPage.toString(),offset:""+(o.paged-1)*o.perPage}))),[e,r,o]);w?.rows&&w.meta&&(g.rows=w.rows.map(q(a)),g.summary=[{key:"total_count",label:(0,m.__)("Labels purchased in this period","woocommerce-shipping"),value:w.meta.totalCount},{key:"total_cost",label:(0,m.__)("Total label cost in this period","woocommerce-shipping"),value:a?.render(w.meta.totalCost)},{key:"total_refunds",label:(0,m.__)("Refund in this period","woocommerce-shipping"),value:w.meta.totalRefunds}]);const y=void 0===w;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(P.ReportFilters,{query:e,path:r,isoDateFormat:h.isoDateFormat}),(0,T.jsx)(F.A,{status:"info",isDismissible:!1,children:(0,m.sprintf)(
// translators: %d is the cache expiration in minutes
// translators: %d is the cache expiration in minutes
(0,m.__)("To improve performance, the data shown here may be up to %d minutes old.","woocommerce-shipping"),window.WCShipping_Config.cacheExpirationInSeconds/60)}),(0,T.jsx)(j.A,{marginBottom:3}),d.length>0&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(F.A,{status:"error",children:d.map(((e,r)=>(0,T.jsx)("p",{children:e},r)))}),(0,T.jsx)(j.A,{marginBottom:3})]}),(0,T.jsx)(P.TableCard,{title:(0,m.__)("Labels in this period","woocommerce-shipping"),rows:g.rows,headers:B,rowsPerPage:o.perPage,totalRows:null!==(t=w?.meta.totalCount)&&void 0!==t?t:0,summary:g.summary,isLoading:y,query:o,actions:[(0,T.jsxs)(L.Ay,{disabled:y||0===g.rows.length||s,onClick:async()=>{let{rows:r}=g;if(u([]),w?.meta.totalCount&&w.meta.totalCount>o.perPage){c(!0);try{r=(await v()({path:f({...e,perPage:"-1",offset:"0"}),method:"GET"})).rows.map(l).map(q(a))}catch{return void u([...d,(0,m.__)("Failed to fetch data for export.","woocommerce-shipping")])}finally{c(!1)}}try{const a={...e};(0,I.downloadCSVFile)((0,I.generateCSVFileName)((0,m.__)("Shipping Labels","woocommerce-shipping"),a),(0,I.generateCSVDataFromTable)(B,r))}catch{u([...d,(0,m.__)("Failed to request download of CSV file.","woocommerce-shipping")])}},title:(0,m.__)("Export CSV","woocommerce-shipping"),isBusy:s,children:[(0,T.jsx)(N,{}),(0,m.__)("Download","woocommerce-shipping")]},"download")],onQueryChange:e=>r=>{"page_size"!==e&&"paged"!==e||i({...o,[(0,p.camelCase)(e)]:parseInt(r,10)})}})]})},O=(0,s.Ay)();A=A||(0,n.createReduxStore)("wcshipping/analytics",{reducer:_,actions:o,selectors:t,controls:c.controls,resolvers:i}),(0,n.register)(A);const M=e=>(0,T.jsx)("div",{className:"wcshipping-label-analytics",children:(0,T.jsx)(E,{...e,currency:O})})}}]);
//# sourceMappingURL=541.js.map
//# debugId=0c39360b-8690-5b66-9f3f-3e20095fc315
